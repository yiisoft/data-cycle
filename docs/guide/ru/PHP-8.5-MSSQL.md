# Последствия использования PHP 8.5 для рабочего процесса MSSQL (Источник ИИ: Claude Sonnet 4.5 - бесплатная пробная версия)

## Краткое резюме

**Не добавляйте PHP 8.5 в рабочий процесс MSSQL пока.** Текущий драйвер pdo_sqlsrv (версия 5.12) не поддерживает PHP 8.5, и рабочий процесс завершится ошибкой во время установки расширений PHP.

## Критический блокер: несовместимость драйвера

### Текущая ситуация

Расширение pdo_sqlsrv 5.12.0, указанное в рабочем процессе, не компилируется с PHP 8.5.0 из-за изменений во внутреннем API PHP. Это означает, что любая попытка добавить PHP 8.5 в тестовую матрицу приведет к немедленному сбою рабочего процесса.

### Статус поддержки драйвера

| Версия PHP | Поддержка pdo_sqlsrv 5.12 |
|------------|---------------------------|
| 8.1        | ✅ Полная поддержка       |
| 8.2        | ✅ Полная поддержка       |
| 8.3        | ✅ Полная поддержка       |
| 8.4        | ⚠️ Неофициальная/Ограниченная |
| 8.5        | ❌ Не поддерживается      |

## Что должно произойти в первую очередь

Прежде чем PHP 8.5 можно будет добавить в рабочий процесс:

1. **Microsoft должна выпустить новую версию драйвера pdo_sqlsrv** (вероятно, 5.13 или 6.0)
2. **Новый драйвер должен быть доступен через PECL** для установки через shivammathur/setup-php
3. **Конфигурация расширений рабочего процесса должна быть обновлена** для ссылки на новую версию драйвера

## Ожидания по срокам

На основе исторических закономерностей с предыдущими релизами PHP:

- **Ожидаемая задержка**: 2-6 месяцев после официального выпуска PHP 8.5
- **Прецедент PHP 8.4**: По состоянию на конец 2024/начало 2025 года PHP 8.4 все еще не имеет полной официальной поддержки драйвера MSSQL
- **Рекомендация**: Следите за репозиторием Microsoft msphpsql для объявлений

## Рекомендуемый план действий

### Фаза 1: Мониторинг (Текущая)

Отслеживайте обновления в следующих ресурсах:

- [Microsoft msphpsql GitHub](https://github.com/microsoft/msphpsql) - Официальный репозиторий драйвера
- [Страница PECL pdo_sqlsrv](https://pecl.php.net/package/pdo_sqlsrv) - Объявления о релизах
- Примечания к выпуску PHP 8.5 и матрицы совместимости

### Фаза 2: Раннее тестирование (Когда драйвер станет доступен)

После выпуска совместимого драйвера:

```yaml
strategy:
  matrix:
    php:
      - 8.1
      - 8.2
      - 8.3
      - 8.4
      - 8.5
```

Обновите конфигурацию расширений:

```yaml
env:
  extensions: pdo, pdo_sqlsrv-5.13  # Или какая бы ни была новая версия
```

Рассмотрите возможность использования `continue-on-error: true` первоначально для заданий PHP 8.5:

```yaml
- name: Run tests with phpunit
  continue-on-error: ${{ matrix.php == '8.5' }}
  run: vendor/bin/phpunit --testsuite=Mssql --coverage-clover=coverage.xml
       --colors=always
```

### Фаза 3: Полная интеграция

После подтверждения стабильности:

- Удалите флаг `continue-on-error`
- Сделайте PHP 8.5 обязательным тестом в конвейере CI

## Потенциальные точки отказа

Если вы добавите PHP 8.5 преждевременно, ожидайте сбоев на следующих этапах:

1. **Этап установки расширений**
   ```
   shivammathur/setup-php@v2
   ```
   Ошибка: Невозможно установить pdo_sqlsrv-5.12 для PHP 8.5

2. **Ошибки компиляции**
   Драйвер может попытаться скомпилироваться, но потерпит неудачу из-за несовместимости API

3. **Ошибки времени выполнения**
   Даже если установка пройдет успешно, несовместимость во время выполнения может привести к сбою тестов

## Функции PHP 8.5, которые следует учитывать

Ожидая поддержки драйвера, обратите внимание на эти изменения PHP 8.5, которые могут повлиять на вашу кодовую базу:

- **Оператор pipe**: Новый синтаксис функционального программирования
- **Синтаксис clone with**: Улучшенное клонирование объектов
- **Устаревшие функции**: Неканонические приведения скалярных типов
- **Другие улучшения**: Хуки свойств, асимметричная видимость

Эти изменения вряд ли напрямую повлияют на операции с базой данных, но могут повлиять на код приложения.

## Стратегия тестирования

Когда поддержка драйвера станет доступной:

1. **Создайте отдельную тестовую ветку** с PHP 8.5, добавленным в матрицу
2. **Запустите полный набор тестов** для всех версий MSSQL (2017, 2019, 2022)
3. **Проверьте предупреждения об устаревании** в выводе тестов
4. **Проверьте совместимость** со всеми версиями PHP в матрице
5. **Отслеживайте регрессии производительности**

## Текущий статус рабочего процесса

Рабочий процесс в настоящее время тестирует:

- **Версии PHP**: 8.1, 8.2, 8.3, 8.4
- **Версии MSSQL**: 2017 (ODBC 17), 2019 (ODBC 18), 2022 (ODBC 18)
- **Версия драйвера**: pdo_sqlsrv-5.12

Эта конфигурация стабильна и должна оставаться неизменной до подтверждения совместимости драйвера.

## Заключение

**Требуемое действие**: В настоящее время никакого. Продолжайте мониторинг обновлений драйвера pdo_sqlsrv.

**Не делайте**: Не добавляйте PHP 8.5 в тестовую матрицу, пока Microsoft не выпустит совместимую версию драйвера.

**Следующие шаги**: Следите за репозиторием Microsoft msphpsql на GitHub для объявлений о релизах и обновляйте этот документ, когда станет доступна новая информация.

---

**Последнее обновление**: 21 января 2026 г.  
**Статус**: Ожидание поддержки драйвера pdo_sqlsrv для PHP 8.5

## Можно ли также обновить actions checkout до версии 6?

**Что нового в v6**
Версия 6 включает поддержку Node.js 24 и сохраняет учетные данные в отдельный файл PHP, а также улучшения поддержки worktree.

**Путь обновления**
Вы можете безопасно обновиться с v3 → v4 → v5 → v6 или перейти сразу на v6. Действие поддерживает обратную совместимость для базового использования.

**Обновленный рабочий процесс**
Вот ваш рабочий процесс с действием checkout, обновленным до v6:

```yaml
- name: Checkout
  uses: actions/checkout@v4  # Можно обновить до @v6
```

Должно стать:

```yaml
- name: Checkout
  uses: actions/checkout@v6
```

**Стоит ли обновляться?**
Да, вам следует обновиться по нескольким причинам:

**Обновления безопасности** - Новые версии включают исправления безопасности
**Поддержка Node.js 24** - Лучшая производительность и совместимость

**Исправления ошибок** - Различные улучшения и повышение стабильности
**Подготовка к будущему** - v3 довольно старая и может в конечном итоге устареть

## Соображения при миграции

Обновление с v3 до v6 должно быть безболезненным для вашего случая использования, поскольку вы используете базовый checkout без специальных параметров.

**Однако рекомендуется:**

1. Сначала протестировать рабочий процесс в функциональной ветке
2. Просмотреть changelog на наличие критических изменений
3. Рассмотреть возможность закрепления на конкретном SHA коммита для максимальной стабильности в продакшене (например, actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8)

Для вашего рабочего процесса простое обновление версии вполне приемлемо и рекомендуется!

---

Claude - это ИИ и может делать ошибки. Пожалуйста, перепроверяйте цитируемые источники.
